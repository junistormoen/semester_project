<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My app</title>
</head>


<body>
    <div id="divHeader">
        <h1>Kokeboka mi</h1>
    </div>
    <div id="divContent"></div>
    <div id="divFooter"></div>


    <!--  Templates -->
    <template id="tpLogin">
        <form id="loginForm">
            <input type="text" id="loginMail" placeholder="Email"> <br>
            <input type="password" id="loginPassword" placeholder="Password"> <br>
            <button id="btnSignIn" type="submit">Logg inn</button>
            <button id="btnNewUser">Ny bruker</button>
        </form>
    </template>

    <template id="tpNewUser">
        <form id="newUserForm">
            Name : <input type="text" id="name"><br>
            Email: <input type="email" id="email"><br />
            Password: <input type="password" id="pswHash"><br />
            <button type="submit" id="createUserButton">Create User</button>
        </form>
    </template>

    <template id="tpHomePage">
        <button id="btnUser">Min Bruker</button>
        <button id="btnAddRsp">Ny oppskrift</button>
    </template>

    <template id="tpUserPage">
        <button id="btnLogout">Logg ut</button>
        <div id="userInfo"></div>
        <button id="btnEditUser">Rediger</button>
        <button id="btnDeleteUser">Slett bruker</button>
    </template>



    <!--<script src="./script/templateLoader.js"></script>
    <script src="./script/main.js"></script>-->



    <script>
        const divContent = document.getElementById("divContent");

        const token = localStorage.getItem("token");
        console.log(token);

        if (token) {
            loadHomeScreen();

        } else {
            const loginForm = document.getElementById("loginForm");

            divContent.innerHTML = document.getElementById("tpLogin").innerHTML;
            const btnSignIn = document.getElementById("btnSignIn");
            const btnNewUser = document.getElementById("btnNewUser");

            btnSignIn.addEventListener("click", async function (evt) {
                evt.preventDefault();

                const email = document.getElementById("loginMail").value;
                const pswHash = document.getElementById("loginPassword").value;

                const response = await postTo("/user/login", { email, pswHash });

                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem("token", data.token);
                    console.log("HEI")
                    loadHomeScreen();
                } else {
                    const error = await response.json();
                    console.error(error.message);
                }
            });


            btnNewUser.addEventListener("click", async function (evt) {
                divContent.innerHTML = document.getElementById("tpNewUser").innerHTML;

                const createUserButton = document.getElementById("createUserButton");
                createUserButton.addEventListener("click", createUser);
            })

        }

        async function createUser() {
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const pswHash = document.getElementById("pswHash").value;

            const user = { name, email, pswHash };

            const response = await postTo("/user/register", user);
        }


        async function postTo(url, data) {
            const header = {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            };

            console.log(header.body);

            const response = await fetch(url, header);
            return response;
        }

        async function loadHomeScreen() {
            divContent.innerHTML = document.getElementById("tpHomePage").innerHTML;


            // Profilknapp  -> Logge ut, slette bruker, tilbake

            // Legge til oppskrift, Liste oppskrift navn, redigere oppskrifter, fjerne oppskrifter
        }

    </script>

</body>

</html>